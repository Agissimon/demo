<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Equipment</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
<header>
    <h1>Search Equipment</h1>
</header>
<nav>
    <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/addEquipment">Add Equipment</a></li>
        <li><a href="/updateEquipment">Update Equipment</a></li>
        <li><a href="/searchEquipment">Search Equipment</a></li>
        <li><a href="/reports">Reports</a></li>
    </ul>
</nav>
<main>
    <form id="searchForm" class="form-center">
        <label for="search">Search Equipment:</label>
        <input type="text" id="search" name="search" required>
        <br>
        <button type="submit">Search</button>
    </form>
    <div id="results"></div>
</main>
<footer>
    <p>&copy; 2024 Equipment Management System</p>
</footer>

<script>
    document.getElementById('searchForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        const searchValue = document.getElementById('search').value;
        const response = await fetch(`/api/v1/equipment/search?query=${searchValue}`);
        const data = await response.json();
        renderResults(data);
    });

    function renderResults(data) {
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = '<table class="styled-table"><thead><tr><th>ID</th><th>Category</th><th>Product Line</th><th>Name Product</th><th>Serial Number</th><th>Status</th><th>Actions</th></tr></thead><tbody></tbody></table>';
        const tableBody = resultsDiv.querySelector('tbody');

        data.forEach(equipment => {
            const row = document.createElement('tr');
            row.innerHTML = `
            <td>${equipment.id_equipment}</td>
            <td>${equipment.category}</td>
            <td>${equipment.product_line}</td>
            <td>${equipment.name_product}</td>
            <td>${equipment.serial_number}</td>
            <td>
                <select data-id="${equipment.id_equipment}" class="status-select">
                    <option value="Active" ${equipment.status === 'Active' ? 'selected' : ''}>Active</option>
                    <option value="Inactive" ${equipment.status === 'Inactive' ? 'selected' : ''}>Inactive</option>
                    <option value="Maintenance" ${equipment.status === 'Maintenance' ? 'selected' : ''}>Maintenance</option>
                </select>
            </td>
            <td><button class="save-button" data-id="${equipment.id_equipment}">Save</button></td>
        `;
            tableBody.appendChild(row);
        });

        document.querySelectorAll('.save-button').forEach(button => {
            button.addEventListener('click', async function() {
                const id = this.getAttribute('data-id');
                const statusSelect = document.querySelector(`select[data-id="${id}"]`);
                const newStatus = statusSelect.value;

                const response = await fetch(`/api/v1/equipment/${id}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id_equipment_status: id,
                        location: "New Location",
                        id_equipment: id,
                        date_start: new Date().toISOString(),
                        date_end: null,
                        current_status: newStatus,
                        id_responsible_company: 1,
                        id_responsible_customer_company: 2
                    })
                });

                if (response.ok) {
                    alert('Status updated successfully!');
                } else {
                    alert('Error updating status');
                }
            });
        });
    }
</script>
</body>
</html>
